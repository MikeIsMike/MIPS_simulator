#!/bin/bash
args=("$@")
echo args[0] is ${args[0]} #${args[1]} ${args[2]}
NUMBER=0
TESTS="./test/*.bin"
TEXTFILE="./test/input.txt"

for T in $TESTS
do
    fullfilename="${T%.*}" #get filename without extension
    filename=$(basename "$fullfilename") #get rid of path to the file

    testname="${filename%%.*}" #get testname which is before first "."
    author="${filename#*.}" #get what is after the first "."
    author="${author%%.*}" #get author which is between first and second "."
    result="${filename##*.}" #get expected result which is between last and second last dots
#echo $result
if [[ $testname == *"getc"* ]];
then
    cat $TEXTFILE | ${args[0]} $T
    EXITCODE=$?
    if [ $result -eq $EXITCODE ]; #space between square brackets are necessary
    then
        echo "$NUMBER, $testname, pass, $author" #author is between first and second dots
    else
        echo "$NUMBER, $testname, fail, $author (expected result $result, got $EXITCODE)"
    fi
        NUMBER=$((NUMBER+1))

elif [[ $testname == *"divideByZero"* ]];
then
    ${args[0]} $T
    EXITCODE=$?
    if [ $result -ne $EXITCODE ]; #space between square brackets are necessary
    then
        echo "$NUMBER, $testname, pass, $author" #author is between first and second dots
    else
        echo "$NUMBER, $testname, fail, $author (result cannot be $result, got $EXITCODE)"
    fi
        NUMBER=$((NUMBER+1))

elif [[ $testname == *"putc"* ]];
then
    OUTPUT=$(cat $TEXTFILE | ${args[0]} $T)
    EXITCODE=$?

    #if [ $OUTPUT -eq $(cat ./test/input.txt) ]; #space between square brackets are necessary
    if [ $OUTPUT == $result ]
    then
        echo "$NUMBER, $testname, pass, $author, output is $OUTPUT" #author is between first and second dots
    else
        echo "$NUMBER, $testname, fail, $author, (expected $result, got $OUTPUT)"
    fi
        NUMBER=$((NUMBER+1))

else
    ${args[0]} $T
    EXITCODE=$?
    if [ $result -eq $EXITCODE ]; #space between square brackets are necessary
    then
        echo "$NUMBER, $testname, pass, $author" #author is between first and second dots
    else
        echo "$NUMBER, $testname, fail, $author (expected result $result, got $EXITCODE)"
    fi
        NUMBER=$((NUMBER+1))

fi

done



#needs to get result from simulator to replace 0 here!!!!!!
